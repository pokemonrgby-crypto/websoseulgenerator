<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>웹소설 생성기 (SPA-V7)</title>
    <style>
        /* [신규] 다크 모드 "게임 UI" 테마 CSS */
        :root {
            --bg-dark-1: #1a1c20;
            --bg-dark-2: #25282e;
            --bg-dark-3: #2c3038;
            --border-color: #444;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-blue: #007aff;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background: var(--bg-dark-1);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
        }

        /* --- 셸 레이아웃 --- */
        #keybar {
            position: sticky;
            top: 0;
            z-index: 50;
            background: var(--bg-dark-2);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        #app-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* --- 공용 컴포넌트 (높은 가독성) --- */
        h1, h2, h3 { color: var(--text-primary); margin: 0 0 16px 0; font-weight: 600; }
        
        button {
            background: var(--accent-blue);
            color: #fff;
            border: 0;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: background 0.2s;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #555; color: #999; cursor: not-allowed; }

        button.sub, button.secondary {
            background: var(--bg-dark-3);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        button.sub:hover, button.secondary:hover { background: #3a3f48; }

        button.danger {
            background: #4a272c;
            color: #ffc2c2;
            border: 1px solid #dc3545;
        }
        button.danger:hover { background: #6b2f38; }

        button.resource {
            background: #1f3a52;
            color: #b3e0ff;
            border: 1px solid #0056b3;
        }
        button.resource:hover { background: #2f5a80; }

        button.save { background: var(--accent-green); }
        button.save:hover { background: #1e7e34; }

        input, textarea, select {
            background: var(--bg-dark-1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            font-family: var(--font-family);
            font-size: 14px;
        }
        input:focus, textarea:focus {
            border-color: var(--accent-blue);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.5);
        }

        pre {
            background: var(--bg-dark-2);
            padding: 12px;
            border-radius: 8px;
            white-space: pre-wrap;
            word-break: break-word;
            color: var(--text-secondary);
        }

        /* --- 뷰별 컨테이너 --- */
        .card {
            background: var(--bg-dark-2);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        .meta { color: var(--text-secondary); font-size: 12px; }
        .row { display: flex; gap: 8px; }

        /* 집필실 (novel) */
        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px;
            height: calc(100vh - 120px); /* 100vh - keybar - padding */
        }
        .main-content {
            background: var(--bg-dark-2); border-radius: 12px; padding: 20px;
            display: flex; flex-direction: column; gap: 12px;
        }
        .side {
            background: var(--bg-dark-2); border-radius: 12px; padding: 20px;
            display: flex; flex-direction: column; gap: 16px; overflow-y: auto;
        }
        .blocks {
            flex: 1; overflow-y: auto; border: 1px solid var(--border-color);
            padding: 10px; border-radius: 8px;
        }
        .blocks p { margin: 8px 0; line-height: 1.6; }

        /* 리소스 (resource) */
        .tab-nav { display: flex; gap: 4px; border-bottom: 2px solid var(--border-color); margin-bottom: 20px; }
        .tab-nav button { background: var(--bg-dark-2); border-bottom: 0; border-radius: 8px 8px 0 0; }
        .tab-nav button.active {
            background: var(--bg-dark-1);
            border: 2px solid var(--border-color);
            border-bottom: 2px solid var(--bg-dark-1);
            font-weight: bold;
            transform: translateY(2px);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .resource-card {
            background: var(--bg-dark-3);
            border: 1px solid var(--border-color);
            border-radius: 8px; padding: 12px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .field { display: flex; gap: 4px; align-items: center; }
        .field input.key { flex: 1; }
        /* [수정] .field input.value -> .field textarea.value */
        .field textarea.value { 
            flex: 2; 
            /* [신규] textarea 높이 자동조절을 위해 min-height 추가 */
            min-height: 38px; /* padding 10*2 + line-height (approx 18) */
            height: 38px;
            resize: none;
            overflow-y: hidden; /* 스크롤바 숨김 */
        }
        .field button.del-field {
            background: #4a272c; color: #ffc2c2; border: 1px solid #dc3545;
            padding: 0 8px; font-size: 14px; border-radius: 4px;
            height: 30px;
            min-width: 30px; /* [신규] 버튼 최소 너비 */
        }
        .card-actions { display: flex; gap: 8px; margin-top: 8px; }
        .card-actions button { font-size: 12px; padding: 6px 10px; }
    </style>
</head>
<body>

    <div id="keybar">
        <!-- [수정] 규칙 #3: 이모지 -> 텍스트 -->
        <strong style="color: var(--text-primary);">[키] 경비실 키</strong>
        <input id="secretKeyInput" placeholder="MY_SECRET_KEY" style="flex:1;max-width:360px;">
        <button id="saveSecretKeyButton">저장</button>
        <button id="deleteSecretKeyButton" class="secondary">삭제</button>
        <span id="keyStatus" style="margin-left:8px;color:var(--text-secondary);font-size:12px;"></span>
    </div>
    <script>
    (function(){
        const $=id=>document.getElementById(id);
        const input=$('secretKeyInput'), status=$('keyStatus');
        const v=localStorage.getItem('MY_SECRET_KEY')||'';
        input.value=v; status.textContent=v?'저장됨':'미저장';
        $('saveSecretKeyButton').onclick=()=>{ const t=input.value.trim(); if(!t) return alert('값이 비어있어.'); localStorage.setItem('MY_SECRET_KEY',t); status.textContent='저장됨'; /* ui-utils 로드 전이므로 alert 사용 */ };
        $('deleteSecretKeyButton').onclick=()=>{ localStorage.removeItem('MY_SECRET_KEY'); input.value=''; status.textContent='미저장'; alert('키 삭제 완료!'); };
    })();
    </script>
    <div id="app-container">
        <h1>로딩 중...</h1>
    </div>

    <script type="module">
        // 라우터를 임포트하여 앱 실행
        import { initRouter } from './public/router.js';
        initRouter();
    </script>
</body>
</html>
